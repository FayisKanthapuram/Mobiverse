<div class="page-header">
  <div class="page-title-group">
    <h2>Brands Management</h2>
    <span>Manage all mobile brands available on Mobiverse.</span>
  </div>
  <button type="button" class="btn-primary-admin" id="open-add-modal-btn">
    <i class="bi bi-plus-lg"></i>
    Add Brand
  </button>
</div>

<div class="filter-bar">
  <form action="/admin/brands" method="GET" class="search-wrapper" id="brand-search-form">
    <i class="bi bi-search"></i>
    <input type="text" name="search" id="brand-search-input" placeholder="Search by brand name..." value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>" autocomplete="off" />
    <input type="hidden" name="filter" id="filter-hidden-input" value="<%= typeof filter !== 'undefined' ? filter : 'All' %>" />

    <% if (typeof searchQuery !== 'undefined' && searchQuery.trim() !== '') { %>
    <a href="/admin/brands?<%= `filter=${encodeURIComponent(filter || 'All')}` %>" class="btn-clear">
      Clear
    </a>
    <% } %>
  </form>


  <div class="filter-dropdown-container">
    <button type="button" class="filter-dropdown-btn" id="filter-btn">
      <span id="filter-btn-text">
        <% if (filter === 'listed') { %>
        Listed
        <% } else if (filter === 'unlisted') { %>
        Unlisted
        <% } else { %>
        All
        <% } %>
      </span>
      <i class="bi bi-chevron-down"></i>
    </button>

    <div class="filter-dropdown-menu" id="filter-menu">
      <a href="/admin/brands?filter=All" class="filter-option" data-value="All">All</a>
      <a href="/admin/brands?filter=listed" class="filter-option" data-value="Listed">Listed</a>
      <a href="/admin/brands?filter=unlisted" class="filter-option" data-value="Unlisted">Unlisted</a>
    </div>
  </div>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Brand Logo</th>
        <th>Brand Name</th>
        <th>Product Count</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (brands && brands.length> 0) { %> <% brands.forEach(brand=> { %>
      <tr>
        <td>
          <div class="brand-logo-cell">
            <img src="<%= brand.logo %>" alt="<%= brand.brandName %>" />
          </div>
        </td>
        <td><strong> <%= brand.brandName %> </strong></td>
        <td><%= brand.productCount %></td>
        <td>
          <% if (brand.isListed) { %>
          <span class="status-badge status-listed">Listed</span>
          <% } else { %>
          <span class="status-badge status-unlisted">Unlisted</span>
          <% } %>
        </td>
        <td>
          <div class="action-buttons">
            <button type="button" class="btn-icon-edit open-edit-modal-btn" data-brand-id="<%= brand._id %>" data-brand-name="<%= brand.brandName %>" data-brand-image="<%= brand.logo %>" data-brand-isListed="<%=brand.isListed%>">
              <i class="bi bi-pencil-fill"></i>
            </button>

            <a href="" class="btn-action btn-unlist" data-brand-id="<%= brand._id %>" data-brand-isListed="<%=brand.isListed%>"><% if (brand.isListed) { %> Unlist <% } else { %> List <% } %></a>
          </div>
        </td>
      </tr>
      <% }) %> <% } else { %>
      <tr>
        <td colspan="5" style="text-align: center; color: #6c757d; padding: 3rem">
          No brands found.
        </td>
      </tr>
      <% } %>
    </tbody>
  </table>
</div>

<div class="pagination-footer">
  <% if (brands && brands.length > 0) { %> <% const startItem = (currentPage -
  1) * limit + 1; const endItem = (currentPage - 1) * limit + brands.length; %>
  <span>Showing <%= startItem %> to <%= endItem %> of <%= totalDocuments %>
    results</span>
  <% } else { %>
  <span>No results found</span>
  <% } %>

  <div class="pagination-controls">
    <% if(currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>&search=<%= searchQuery %>&filter=<%= filter %>" class="page-arrow">
      <i class="bi bi-chevron-left"></i>
    </a>
    <% } else { %>
    <span classa="page-arrow disabled" aria-disabled="true">
      <i class="bi bi-chevron-left"></i>
    </span>
    <% } %> <% for(let i = 1; i <= totalPages; i++) { %>
    <a href="?page=<%= i %>&search=<%= searchQuery %>&filter=<%= filter %>" class="page-number <%= currentPage === i ? 'active' : '' %>">
      <%= i %>
    </a>
    <% } %> <% if(currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>&search=<%= searchQuery %>&filter=<%= filter %>" class="page-arrow">
      <i class="bi bi-chevron-right"></i>
    </a>
    <% } else { %>
    <span class="page-arrow disabled" aria-disabled="true">
      <i class="bi bi-chevron-right"></i>
    </span>
    <% } %>
  </div>
</div>

<div class="modal-overlay-admin" id="modal-overlay"></div>

<div class="modal-admin" id="add-brand-modal">
  <div class="modal-header">
    <h2>Add New Brand</h2>
    <button class="modal-close-btn" data-close-target="#add-brand-modal">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <form id="add-brand-form" enctype="multipart/form-data" class="modal-body">
    <div class="form-group-admin">
      <label for="brandName">Brand Name <span class="required-star">*</span></label>
      <input type="text" id="brandName" name="brandName" placeholder="Enter brand name" required />
    </div>

    <div class="form-group-admin">
      <label for="brandLogoAdd">Brand Logo</label>

      <div class="upload-container" id="uploadContainer">
        <input type="file" id="brandLogoAdd" name="brandLogo" accept="image/*" hidden />
        <div class="upload-placeholder" id="uploadPlaceholder">
          <i class="bi bi-image"></i>
          <p>Click to Upload Logo</p>
        </div>
        <div class="upload-preview" id="uploadPreview" style="display: none">
          <img id="croppedImagePreview" alt="Cropped Preview" />
          <button type="button" id="changeImageBtn" class="btn-secondary-admin small">
            Change Image
          </button>
        </div>
      </div>

      <!-- Cropper Modal (inline) -->
      <div id="cropperModal" class="cropper-modal">
        <div class="cropper-wrapper">
          <img id="cropperImage" alt="Crop area" />
        </div>
        <div class="cropper-actions">
          <button type="button" id="cancelCropBtn" class="btn-secondary-admin">
            Cancel
          </button>
          <button type="button" id="applyCropBtn" class="btn-primary-admin">
            Apply Crop
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-secondary-admin" data-close-target="#add-brand-modal">
        Cancel
      </button>
      <button type="submit" class="btn-primary-admin">Save</button>
    </div>
  </form>
</div>

<div class="modal-admin" id="edit-brand-modal">
  <div class="modal-header">
    <h2>Edit Brand</h2>
    <button class="modal-close-btn" data-close-target="#edit-brand-modal">
      <i class="bi bi-x-lg"></i>
    </button>
  </div>

  <form id="edit-brand-form" enctype="multipart/form-data" class="modal-body">
    <input type="hidden" id="editBrandId" name="brandId" />

    <div class="form-group-admin">
      <label for="editBrandName">Brand Name</label>
      <input type="text" id="editBrandName" name="brandName" required />
    </div>

    <div class="form-group-admin">
      <label for="brandLogoEdit">Brand Logo</label>

      <div class="upload-container" id="uploadContainerEdit">
        <input type="file" id="brandLogoEdit" name="brandLogo" accept="image/*" hidden />
        <div class="upload-placeholder" id="uploadPlaceholderEdit">
          <i class="bi bi-image"></i>
          <p>Click to Upload Logo</p>
        </div>
        <div class="upload-preview" id="uploadPreviewEdit" style="display: none">
          <img id="croppedImagePreviewEdit" alt="Cropped Preview" />
          <button type="button" id="changeImageBtnEdit" class="btn-secondary-admin small">
            Change Image
          </button>
        </div>
      </div>

      <!-- Cropper Modal for Edit -->
      <div id="cropperModalEdit" class="cropper-modal">
        <div class="cropper-wrapper">
          <img id="cropperImageEdit" alt="Crop area" />
        </div>
        <div class="cropper-actions">
          <button type="button" id="cancelCropBtnEdit" class="btn-secondary-admin">
            Cancel
          </button>
          <button type="button" id="applyCropBtnEdit" class="btn-primary-admin">
            Apply Crop
          </button>
        </div>
      </div>
    </div>


    <div class="modal-footer">
      <button type="button" class="btn-secondary-admin" data-close-target="#edit-brand-modal">
        Cancel
      </button>
      <button type="submit" class="btn-primary-admin">Save Changes</button>
    </div>
  </form>
</div>