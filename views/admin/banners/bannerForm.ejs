<% /* views/admin/banners/bannerForm.ejs */ %>

<div class="max-w-5xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <a href="/admin/banners" class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 mb-4">
      <i class="bi bi-arrow-left"></i>
      <span>Back to Banners</span>
    </a>
    <h1 class="text-3xl font-bold text-gray-900">
      <%= banner ? 'Edit Banner' : 'Create New Banner' %>
    </h1>
  </div>

  <!-- Form -->
  <form id="banner-form" class="space-y-8">
    
    <!-- Basic Information Card -->
    <div class="bg-white rounded-xl shadow-md p-8">
      <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
        <i class="bi bi-info-circle text-blue-600"></i>
        Basic Information
      </h2>

      <!-- Title -->
      <div class="mb-6">
        <label for="title" class="block text-sm font-semibold text-gray-700 mb-2">
          Banner Title <span class="text-red-500">*</span>
        </label>
        <input type="text" 
               id="title" 
               name="title" 
               value="<%= banner ? banner.title : '' %>"
               placeholder="e.g., SAMSUNG GALAXY S23 ULTRA 5G"
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
               required>
      </div>

      <!-- Subtitle -->
      <div class="mb-6">
        <label for="subtitle" class="block text-sm font-semibold text-gray-700 mb-2">
          Banner Subtitle <span class="text-red-500">*</span>
        </label>
        <textarea id="subtitle" 
                  name="subtitle" 
                  rows="3"
                  placeholder="e.g., The Future in Your Hand. Order now and get exclusive launch offers."
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  required><%= banner ? banner.subtitle : '' %></textarea>
      </div>

      <!-- Link -->
      <div class="mb-6">
        <label for="link" class="block text-sm font-semibold text-gray-700 mb-2">
          Banner Link
        </label>
        <input type="text" 
               id="link" 
               name="link" 
               value="<%= banner ? banner.link : '' %>"
               placeholder="e.g., /shop/s23-ultra or https://example.com"
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <p class="text-sm text-gray-500 mt-1">Leave empty if no link is needed</p>
      </div>

      <!-- Background Color -->
      <div>
        <label for="backgroundColor" class="block text-sm font-semibold text-gray-700 mb-2">
          Background Color
        </label>
        <div class="flex items-center gap-3">
          <input type="color" 
                 id="backgroundColor" 
                 name="backgroundColor" 
                 value="<%= banner ? banner.backgroundColor : '#1f2937' %>"
                 class="h-12 w-20 border border-gray-300 rounded cursor-pointer">
          <input type="text" 
                 id="backgroundColorHex" 
                 value="<%= banner ? banner.backgroundColor : '#1f2937' %>"
                 placeholder="#1f2937"
                 class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                 readonly>
        </div>
      </div>
    </div>

    <!-- Responsive Images Card -->
    <div class="bg-white rounded-xl shadow-md p-8">
      <h2 class="text-xl font-bold text-gray-900 mb-2 flex items-center gap-2">
        <i class="bi bi-image text-blue-600"></i>
        Responsive Images
      </h2>
      <p class="text-sm text-gray-600 mb-6">Upload different images for various screen sizes for optimal display</p>

      <!-- Desktop Image -->
      <div class="mb-8">
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          Desktop Image (Required) <span class="text-red-500">*</span>
        </label>
        
        <% if (banner && banner.images.desktop) { %>
          <div class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-sm text-gray-600 mb-2">Current Desktop Image:</p>
            <img src="<%= banner.images.desktop %>" alt="Current desktop banner" class="max-h-48 rounded-lg">
          </div>
        <% } %>

        <div class="relative">
          <input type="file" 
                 id="imageDesktop" 
                 name="imageDesktop" 
                 accept="image/*"
                 class="hidden"
                 <%= !banner ? 'required' : '' %>
                 onchange="previewImage(event, 'desktop')">
          <label for="imageDesktop" 
                 class="flex items-center justify-center gap-2 w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors">
            <i class="bi bi-display text-xl text-gray-400"></i>
            <span class="text-gray-600">Click to upload desktop image</span>
          </label>
        </div>

        <div id="imagePreviewDesktop" class="hidden mt-4">
          <div class="relative p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-sm text-gray-600 mb-2">Preview:</p>
            <img id="previewImgDesktop" src="" alt="Preview" class="max-h-48 rounded-lg">
            <button type="button" 
                    onclick="openCropModal('desktop')"
                    class="mt-2 inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              <i class="bi bi-crop"></i>
              <span>Crop Image</span>
            </button>
          </div>
        </div>

        <p class="text-sm text-gray-500 mt-2">Recommended: 1920x600px (PNG, JPG, WebP)</p>
      </div>

      <!-- Tablet Image -->
      <div class="mb-8">
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          Tablet Image (Optional)
        </label>
        
        <% if (banner && banner.images.tablet) { %>
          <div class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-sm text-gray-600 mb-2">Current Tablet Image:</p>
            <img src="<%= banner.images.tablet %>" alt="Current tablet banner" class="max-h-32 rounded-lg">
          </div>
        <% } %>

        <div class="relative">
          <input type="file" 
                 id="imageTablet" 
                 name="imageTablet" 
                 accept="image/*"
                 class="hidden"
                 onchange="previewImage(event, 'tablet')">
          <label for="imageTablet" 
                 class="flex items-center justify-center gap-2 w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors">
            <i class="bi bi-tablet text-xl text-gray-400"></i>
            <span class="text-gray-600">Click to upload tablet image</span>
          </label>
        </div>

        <div id="imagePreviewTablet" class="hidden mt-4">
          <div class="relative p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-sm text-gray-600 mb-2">Preview:</p>
            <img id="previewImgTablet" src="" alt="Preview" class="max-h-32 rounded-lg">
            <button type="button" 
                    onclick="openCropModal('tablet')"
                    class="mt-2 inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              <i class="bi bi-crop"></i>
              <span>Crop Image</span>
            </button>
          </div>
        </div>

        <p class="text-sm text-gray-500 mt-2">Recommended: 1024x450px</p>
      </div>

      <!-- Mobile Image -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          Mobile Image (Optional)
        </label>
        
        <% if (banner && banner.images.mobile) { %>
          <div class="mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-sm text-gray-600 mb-2">Current Mobile Image:</p>
            <img src="<%= banner.images.mobile %>" alt="Current mobile banner" class="max-h-32 rounded-lg">
          </div>
        <% } %>

        <div class="relative">
          <input type="file" 
                 id="imageMobile" 
                 name="imageMobile" 
                 accept="image/*"
                 class="hidden"
                 onchange="previewImage(event, 'mobile')">
          <label for="imageMobile" 
                 class="flex items-center justify-center gap-2 w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors">
            <i class="bi bi-phone text-xl text-gray-400"></i>
            <span class="text-gray-600">Click to upload mobile image</span>
          </label>
        </div>

        <div id="imagePreviewMobile" class="hidden mt-4">
          <div class="relative p-4 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-sm text-gray-600 mb-2">Preview:</p>
            <img id="previewImgMobile" src="" alt="Preview" class="max-h-32 rounded-lg">
            <button type="button" 
                    onclick="openCropModal('mobile')"
                    class="mt-2 inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              <i class="bi bi-crop"></i>
              <span>Crop Image</span>
            </button>
          </div>
        </div>

        <p class="text-sm text-gray-500 mt-2">Recommended: 768x400px</p>
      </div>
    </div>

    <!-- Scheduling Card -->
    <div class="bg-white rounded-xl shadow-md p-8">
      <h2 class="text-xl font-bold text-gray-900 mb-2 flex items-center gap-2">
        <i class="bi bi-calendar-event text-blue-600"></i>
        Schedule Banner
      </h2>
      <p class="text-sm text-gray-600 mb-6">Set start and end dates for automatic banner activation</p>

      <!-- Enable Scheduling -->
      <div class="mb-6">
        <label class="flex items-center cursor-pointer">
          <input type="checkbox" 
                 id="isScheduled" 
                 name="isScheduled" 
                 <%= banner && banner.isScheduled ? 'checked' : '' %>
                 onchange="toggleScheduling()"
                 class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
          <span class="ml-3 text-sm font-semibold text-gray-700">Enable scheduling for this banner</span>
        </label>
      </div>

      <div id="schedulingFields" class="<%= banner && banner.isScheduled ? '' : 'hidden' %> space-y-6">
        <!-- Start Date -->
        <div>
          <label for="scheduledStart" class="block text-sm font-semibold text-gray-700 mb-2">
            Start Date & Time
          </label>
          <input type="datetime-local" 
                 id="scheduledStart" 
                 name="scheduledStart" 
                 value="<%= banner && banner.scheduledStart ? new Date(banner.scheduledStart).toISOString().slice(0, 16) : '' %>"
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <p class="text-sm text-gray-500 mt-1">Leave empty to activate immediately</p>
        </div>

        <!-- End Date -->
        <div>
          <label for="scheduledEnd" class="block text-sm font-semibold text-gray-700 mb-2">
            End Date & Time
          </label>
          <input type="datetime-local" 
                 id="scheduledEnd" 
                 name="scheduledEnd" 
                 value="<%= banner && banner.scheduledEnd ? new Date(banner.scheduledEnd).toISOString().slice(0, 16) : '' %>"
                 class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <p class="text-sm text-gray-500 mt-1">Leave empty for no end date</p>
        </div>
      </div>
    </div>

    <!-- Display Settings Card -->
    <div class="bg-white rounded-xl shadow-md p-8">
      <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
        <i class="bi bi-gear text-blue-600"></i>
        Display Settings
      </h2>

      <!-- Order -->
      <div class="mb-6">
        <label for="order" class="block text-sm font-semibold text-gray-700 mb-2">
          Display Order
        </label>
        <input type="number" 
               id="order" 
               name="order" 
               min="1"
               value="<%= banner ? banner.order : 1 %>"
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <p class="text-sm text-gray-500 mt-1">Lower numbers appear first in the carousel</p>
      </div>

      <!-- Active Status -->
      <div>
        <label class="flex items-center cursor-pointer">
          <input type="checkbox" 
                 id="isActive" 
                 name="isActive" 
                 <%= banner && banner.isActive ? 'checked' : '' %>
                 class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
          <span class="ml-3 text-sm font-semibold text-gray-700">Active (Display on home page)</span>
        </label>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-3">
      <button type="submit" 
              class="flex-1 inline-flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">
        <i class="bi bi-check-circle"></i>
        <span><%= banner ? 'Update Banner' : 'Create Banner' %></span>
      </button>
      <a href="/admin/banners" 
         class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
        <i class="bi bi-x-circle"></i>
        <span>Cancel</span>
      </a>
    </div>
  </form>
</div>

<!-- Image Crop Modal -->
<div id="cropModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
  <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
    <div class="p-6 border-b border-gray-200 flex items-center justify-between">
      <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2">
        <i class="bi bi-crop text-blue-600"></i>
        Crop Image
      </h3>
      <button type="button" onclick="closeCropModal()" class="text-gray-400 hover:text-gray-600 text-2xl">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="p-6 overflow-y-auto max-h-[calc(90vh-200px)]">
      <div class="max-h-[500px] overflow-hidden">
        <img id="cropImage" src="" alt="Crop" class="max-w-full">
      </div>
    </div>
    
    <div class="p-6 border-t border-gray-200 flex items-center justify-between gap-4">
      <div class="flex gap-2">
        <button type="button" onclick="rotateCrop(-90)" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
          <i class="bi bi-arrow-counterclockwise"></i>
        </button>
        <button type="button" onclick="rotateCrop(90)" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
          <i class="bi bi-arrow-clockwise"></i>
        </button>
        <button type="button" onclick="flipCrop('horizontal')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
          <i class="bi bi-arrows-expand"></i> H
        </button>
        <button type="button" onclick="flipCrop('vertical')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
          <i class="bi bi-arrows-collapse"></i> V
        </button>
      </div>
      <div class="flex gap-3">
        <button type="button" onclick="closeCropModal()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
          Cancel
        </button>
        <button type="button" onclick="applyCrop()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          Apply Crop
        </button>
      </div>
    </div>
  </div>
</div>