<main class="container mx-auto px-4 mt-10 mb-16">
  <!-- Breadcrumbs -->
  <div class="mb-6">
    <%- include('../../partials/user/_breadcrumbs', { breadcrumbs }) %>
  </div>

  <div class="flex flex-col lg:flex-row gap-10">
    <!-- Sidebar Filters -->
    <div class="hidden lg:block w-full lg:w-1/4 xl:w-1/5 bg-white shadow-sm border border-gray-200 rounded-2xl p-6 h-fit sticky top-24">
      <!-- Clear Filters Button - Only show if filters are active -->
      <% const hasActiveFilters = (query.brand && query.brand !== 'all') || query.min || query.max || query.sort; %>
      
      <%- include('../../partials/user/shop/_filterSidebar', {
        brands,
        query
      }) %>
    </div>

    <!-- Product Section -->
    <section class="flex-1">
      <!-- Header -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
        <div>
          <h1 class="text-3xl font-bold text-gray-900 mb-1">
            <%= ((query.brand)?query.brand?.charAt(0)?.toUpperCase()+query.brand?.slice(1)?.toLowerCase():'All' )+' Brands Mobiles' %>
          </h1>
          <p class="text-gray-600 text-sm">
            <%= 'Explore the latest ' +((query.brand)?query.brand?.charAt(0)?.toUpperCase()+query.brand?.slice(1)?.toLowerCase():'All' )+ ' Brands smartphones.' %>
          </p>
        </div>

        <!-- Simple Sort Dropdown -->
        <div class="filter-select-wrapper mt-4 md:mt-0">
          <label for="sort-by" class="text-sm text-gray-500 mr-2 font-medium">Sort by:</label>
          <select id="sort-by" name="sort" onchange="applyFilter()" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
            <option value="" <%= !query.sort ? 'selected' : '' %>>Default</option>
            <option value="price-asc" <%= query.sort === 'price-asc' ? 'selected' : '' %>>Price: Low → High</option>
            <option value="price-desc" <%= query.sort === 'price-desc' ? 'selected' : '' %>>Price: High → Low</option>
            <option value="a-z" <%= query.sort === 'a-z' ? 'selected' : '' %>>A → Z</option>
            <option value="z-a" <%= query.sort === 'z-a' ? 'selected' : '' %>>Z → A</option>
            <option value="latest" <%= query.sort === 'latest' ? 'selected' : '' %>>Latest</option>
          </select>
        </div>
      </div>

      <!-- Active Filters Display (Optional - shows what filters are applied) -->
      <% if (hasActiveFilters) { %>
      <div class="mb-6 flex flex-wrap gap-2 items-center">
        <span class="text-sm font-medium text-gray-600">Active Filters:</span>
        <% if (query.brand && query.brand !== 'all') { %>
        <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
          <%= query.brand.charAt(0).toUpperCase() + query.brand.slice(1) %>
          <button onclick="removeBrandFilter()" class="ml-1 hover:text-blue-900">
            <i class="bi bi-x text-sm"></i>
          </button>
        </span>
        <% } %>
        <% if (query.min || query.max) { %>
        <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
          Price: ₹<%= query.min || '0' %> - ₹<%= query.max || '∞' %>
          <button onclick="removePriceFilter()" class="ml-1 hover:text-blue-900">
            <i class="bi bi-x text-sm"></i>
          </button>
        </span>
        <% } %>
        <% if (query.sort) { %>
        <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
          Sort: <%= query.sort %>
          <button onclick="removeSortFilter()" class="ml-1 hover:text-blue-900">
            <i class="bi bi-x text-sm"></i>
          </button>
        </span>
        <% } %>
        <button onclick="clearAllFilters()" class="ml-2 text-sm text-red-600 hover:text-red-800 font-medium">
          Clear All
        </button>
      </div>
      <% } %>

      <!-- Product Grid -->
      <% if (products && products.length > 0) { %>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <% products.forEach(product => { %>
        <%- include('../../partials/user/_productGridCard', { product }) %>
        <% }) %>
      </div>
      <% } else { %>
      <div class="text-center py-20 bg-gray-50 rounded-xl border border-gray-200">
        <h2 class="text-2xl font-semibold text-gray-700 mb-2">No Products Found</h2>
        <p class="text-gray-500 mb-4">Try adjusting your filters to find what you're looking for.</p>
        <% if (hasActiveFilters) { %>
        <button onclick="clearAllFilters()" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
          <i class="bi bi-arrow-counterclockwise"></i>
          Clear Filters
        </button>
        <% } %>
      </div>
      <% } %>

      <!-- Pagination -->
      <% if (pagination && pagination.totalPages > 1) { %>
      <nav class="flex justify-center mt-10" aria-label="Pagination">
        <ul class="inline-flex items-center gap-1">
          <% if (pagination.hasPrevPage) { %>
          <li><a href="javascript:void(0)" onclick="changePage(<%= pagination.currentPage -1 %>)" class="px-3 py-2 text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100"><i class="bi bi-chevron-left"></i></a></li>
          <% } %>
          <% for (let i = 1; i <= pagination.totalPages; i++) { %>
          <li>
            <a href="javascript:void(0)" onclick="changePage(<%= i %>)" class="px-3 py-2 border border-gray-300 rounded-lg text-sm <%= (i === pagination.currentPage) ? 'bg-blue-50 text-blue-600 font-semibold' : 'text-gray-600 hover:bg-gray-100' %>">
              <%= i %>
            </a>
          </li>
          <% } %>
          <% if (pagination.hasNextPage) { %>
          <li><a href="javascript:void(0)" onclick="changePage(<%= pagination.currentPage + 1 %>)" class="px-3 py-2 text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100"><i class="bi bi-chevron-right"></i></a></li>
          <% } %>
        </ul>
      </nav>
      <% } %>
    </section>
  </div>
</main>

